## MySQL Database Design

## Tables
- **Admin**
- **Doctor**
- **Patient**
- **Appointments**

---

##  Table: `Admin`
**Fields**
| Field | Type | Attributes |
|--------|------|-------------|
| `id` | INT | PRIMARY KEY, AUTO_INCREMENT, UNIQUE, NOT NULL |
| `name` | VARCHAR(100) | NOT NULL |
| `username` | VARCHAR(50) | UNIQUE, NOT NULL |
| `password` | VARCHAR(255) | NOT NULL |

---

##  Table: `Doctor`
**Relations**
- **Appointments** → One-to-Many (one doctor can have multiple appointments)  
- **No Cascading:** Instead of deleting appointments when a doctor is deleted, a **trigger** will update all related appointments’ status to `"Canceled"` (status = 2).

**Fields**
| Field | Type | Attributes |
|--------|------|-------------|
| `id` | INT | PRIMARY KEY, AUTO_INCREMENT, UNIQUE, NOT NULL |
| `username` | VARCHAR(50) | UNIQUE, NOT NULL |
| `password` | VARCHAR(255) | NOT NULL |
| `email` | VARCHAR(100) |  |
| `phone` | VARCHAR(20) |  |
| `name` | VARCHAR(100) | NOT NULL |
| `speciality` | VARCHAR(100) | DEFAULT "General" |
| `register_date` | DATE | NOT NULL |

---

##  Table: `Patient`
**Relations**
- **Appointments** → One-to-Many (one patient can have multiple appointments)  
- **No Cascading:** Instead of deleting appointments when a patient is deleted, a **trigger** will update all related appointments’ status to `"Canceled"` (status = 2).

**Fields**
| Field | Type | Attributes |
|--------|------|-------------|
| `id` | INT | PRIMARY KEY, AUTO_INCREMENT, UNIQUE, NOT NULL |
| `username` | VARCHAR(50) | UNIQUE, NOT NULL |
| `password` | VARCHAR(255) | NOT NULL |
| `email` | VARCHAR(100) |  |
| `phone` | VARCHAR(20) |  |
| `name` | VARCHAR(100) | NOT NULL |
| `register_date` | DATE | NOT NULL |

---

##  Table: `Appointments`
**Relations**
- **Patient** → Many-to-One (one patient can have multiple appointments)  
- **Doctor** → Many-to-One (one doctor can have multiple appointments)  
- **No Cascading:** Deletion of doctor or patient should **not delete** appointments — triggers handle cancellation updates instead.

**Fields**
| Field | Type | Attributes |
|--------|------|-------------|
| `id` | INT | PRIMARY KEY, AUTO_INCREMENT, UNIQUE, NOT NULL |
| `patient_id` | INT | FOREIGN KEY → `Patient(id)`, NOT NULL |
| `doctor_id` | INT | FOREIGN KEY → `Doctor(id)`, NOT NULL |
| `appointment_time` | DATETIME | NOT NULL |
| `status` | INT | DEFAULT 0 <br> (0 = Scheduled, 1 = Completed, 2 = Canceled) |

---

## Triggers

**Trigger 1: `cancel_appointments_after_doctor_delete`**  
When a doctor is deleted, all their associated appointments are updated — `status` is set to **2 (Canceled)** instead of deleting the records.

**Trigger 2: `cancel_appointments_after_patient_delete`**  
When a patient is deleted, all their associated appointments are updated — `status` is set to **2 (Canceled)** instead of deleting the records.

---
---

## MongoDB Collection Design

## Collection: `prescriptions`

---

### Overview
Stores information about medications prescribed by doctors to patients.  
This collection uses **integer IDs from the MySQL database** (`patients`, `doctors`, and `appointments` tables) rather than MongoDB ObjectIds for relationships.

---

### Fields

| Field | Type | Description |
|--------|------|-------------|
| `_id` | ObjectId | Unique identifier for the prescription document (auto-generated by MongoDB). |
| `patientId` | INT | **MySQL Patient ID** — links this prescription to a patient record in the SQL database. |
| `doctorId` | INT | **MySQL Doctor ID** — identifies the doctor who issued the prescription. |
| `appointmentId` | INT | **MySQL Appointment ID** — links the prescription to a specific appointment. |
| `medication` | String | Name of the prescribed medication (e.g., “Paracetamol”). |
| `dosage` | String | Dosage details (e.g., “500mg” or “1 tablet every 6 hours”). |
| `doctorNotes` | String | Additional comments or instructions from the doctor. |
| `refillCount` | Number | Number of times the prescription can be refilled. |
| `pharmacy` | Object | Embedded subdocument containing pharmacy information. |
| `pharmacy.name` | String | Name of the pharmacy (e.g., “Walgreens SF”). |
| `pharmacy.location` | String | Address or general location of the pharmacy. |

---

### Relationships
- This collection does **not directly reference MongoDB collections.**
- The fields `patientId`, `doctorId`, and `appointmentId` correspond to **primary keys in your MySQL tables**:
  - `patients.id`
  - `doctors.id`
  - `appointments.id`

Data joining and fetching are handled **in the Java application layer**, not by MongoDB itself.

---

### Example Document
```json
{
  "_id": "ObjectId('64abc123456')",
  "patientId": 1,
  "doctorId": 1,
  "appointmentId": 51,
  "medication": "Paracetamol",
  "dosage": "500mg",
  "doctorNotes": "Take 1 tablet every 6 hours.",
  "refillCount": 2,
  "pharmacy": {
    "name": "Walgreens SF",
    "location": "Market Street"
  }
}
